# ============================================================================
# Vaultize Analytics Platform - STAGING Environment Configuration
# ============================================================================
#
# Copy this file to .env.staging and customize for your staging environment
#
# Authors: Balaji Rajan and Claude (Anthropic)
# License: Apache 2.0
#
# IMPORTANT: This file should NOT be committed to Git
# Add .env.staging to .gitignore
#

# ============================================================================
# Environment Identifier
# ============================================================================

ENVIRONMENT=staging
DEBUG=false

# ============================================================================
# OpenSearch Configuration
# ============================================================================

OPENSEARCH_VERSION=2.11.1
OPENSEARCH_CLUSTER_NAME=vaultize-staging-cluster
OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g

# Connection Settings
# Replace with your staging OpenSearch hostname/IP
OPENSEARCH_HOST=opensearch.staging.internal
OPENSEARCH_PORT=9200
OPENSEARCH_SCHEME=https  # Use HTTPS in staging/production

# Security (ENABLE IN STAGING)
OPENSEARCH_SECURITY_ENABLED=true
OPENSEARCH_ADMIN_USERNAME=admin
OPENSEARCH_ADMIN_PASSWORD=CHANGE_ME_STAGING_PASSWORD
OPENSEARCH_VERIFY_CERTS=false  # Set to true if using valid certificates

# ============================================================================
# OpenSearch Dashboards Configuration
# ============================================================================

OPENSEARCH_DASHBOARDS_VERSION=2.11.1
OPENSEARCH_DASHBOARDS_PORT=5601

# Public URL - Replace with your staging domain
OPENSEARCH_DASHBOARDS_PUBLIC_URL=https://dashboards.staging.example.com
OPENSEARCH_DASHBOARDS_BASE_PATH=  # e.g., /dashboards if behind reverse proxy

# ============================================================================
# Fluent Bit Configuration
# ============================================================================

FLUENT_BIT_VERSION=2.2.0
FLUENT_BIT_HTTP_PORT=2020
FLUENT_BIT_FORWARD_PORT=24224

# OpenSearch output configuration
FLUENT_BIT_OPENSEARCH_HOST=opensearch.staging.internal
FLUENT_BIT_OPENSEARCH_PORT=9200
FLUENT_BIT_OPENSEARCH_SCHEME=https
FLUENT_BIT_OPENSEARCH_USER=admin
FLUENT_BIT_OPENSEARCH_PASSWORD=CHANGE_ME_STAGING_PASSWORD

# ============================================================================
# Prometheus Configuration (Optional)
# ============================================================================

PROMETHEUS_VERSION=v2.48.1
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION=30d  # Longer retention for staging

# Public URL
PROMETHEUS_URL=https://prometheus.staging.example.com

# ============================================================================
# Grafana Configuration (Optional)
# ============================================================================

GRAFANA_VERSION=10.2.3
GRAFANA_PORT=3000

# Credentials
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STAGING_PASSWORD

# Public URLs
GRAFANA_URL=https://grafana.staging.example.com
GRAFANA_ROOT_URL=https://grafana.staging.example.com

# ============================================================================
# Analytics API Configuration
# ============================================================================

API_HOST=0.0.0.0
API_PORT=8000
API_LOG_LEVEL=INFO
API_WORKERS=4
API_RELOAD=false

# Public URL
API_BASE_URL=https://api.staging.example.com
API_ROOT_PATH=/api/v1

# CORS Configuration - Restrict to staging frontend
API_CORS_ORIGINS=https://staging.example.com,https://app.staging.example.com

# ============================================================================
# Alerting Service Configuration
# ============================================================================

ALERTING_LOG_LEVEL=INFO
ALERTING_CHECK_INTERVAL=60  # seconds
ALERTING_WEBHOOK_TIMEOUT=10  # seconds

# ============================================================================
# Network Configuration
# ============================================================================

NETWORK_SUBNET=172.25.0.0/16

# ============================================================================
# Storage Configuration
# ============================================================================

# Data retention policies
LOG_RETENTION_DAYS=30
METRICS_RETENTION_DAYS=30

# ============================================================================
# Resource Limits (Staging - Moderate)
# ============================================================================

OPENSEARCH_MEM_LIMIT=2g
FLUENT_BIT_MEM_LIMIT=512m
PROMETHEUS_MEM_LIMIT=1g
GRAFANA_MEM_LIMIT=512m

# ============================================================================
# External Integrations
# ============================================================================

# Webhook for alerts - Staging Slack channel
ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/STAGING/WEBHOOK

# Email settings (optional)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=alerts-staging@example.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_FROM=alerts-staging@example.com
SMTP_USE_TLS=true

# ============================================================================
# TLS/SSL Configuration
# ============================================================================

# Paths to certificates (if using custom certs)
TLS_CERT_PATH=/etc/ssl/certs/staging.crt
TLS_KEY_PATH=/etc/ssl/private/staging.key
TLS_CA_PATH=/etc/ssl/certs/ca-staging.crt

# ============================================================================
# Backup Configuration
# ============================================================================

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=7
BACKUP_S3_BUCKET=vaultize-staging-backups  # If using S3-compatible storage
BACKUP_LOCAL_PATH=/backups

# ============================================================================
# Monitoring & Observability
# ============================================================================

# Send metrics to monitoring system
METRICS_EXPORT_ENABLED=true
METRICS_EXPORT_ENDPOINT=https://monitoring.staging.example.com/metrics

# Trace sampling (APM/distributed tracing)
TRACING_ENABLED=false
TRACING_SAMPLE_RATE=0.1  # 10% sampling in staging

# ============================================================================
# Feature Flags (Testing in Staging)
# ============================================================================

# Enable experimental features for testing
FEATURE_VECTOR_SEARCH=false
FEATURE_ML_ANOMALY_DETECTION=false
FEATURE_ADVANCED_ALERTING=true

# ============================================================================
# Rate Limiting
# ============================================================================

API_RATE_LIMIT_ENABLED=true
API_RATE_LIMIT_PER_MINUTE=1000
API_RATE_LIMIT_BURST=100

# ============================================================================
# Notes for Staging Environment
# ============================================================================
#
# 1. Use HTTPS for all public-facing URLs
# 2. Enable basic security (authentication)
# 3. Use staging-specific credentials (never use production credentials)
# 4. Configure alerts to go to staging Slack channel
# 5. Test certificate validation
# 6. Moderate resource limits (between dev and prod)
# 7. Keep logs for 30 days (same as production for testing)
# 8. Enable backups to test backup/restore procedures
# 9. Monitor staging environment to catch issues before production
# 10. Use staging as final validation before production deployment
#
