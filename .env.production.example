# ============================================================================
# Vaultize Analytics Platform - PRODUCTION Environment Configuration
# ============================================================================
#
# Copy this file to .env.production and customize for your production environment
#
# Authors: Balaji Rajan and Claude (Anthropic)
# License: Apache 2.0
#
# CRITICAL: This file should NEVER be committed to Git
# Add .env.production to .gitignore
#
# SECURITY CHECKLIST:
# [ ] All default passwords changed
# [ ] TLS/SSL enabled for all services
# [ ] Authentication enabled
# [ ] Firewall rules configured
# [ ] Backup system tested
# [ ] Monitoring configured
# [ ] Secrets stored in secrets manager (not in this file)
#

# ============================================================================
# Environment Identifier
# ============================================================================

ENVIRONMENT=production
DEBUG=false

# ============================================================================
# OpenSearch Configuration
# ============================================================================

OPENSEARCH_VERSION=2.11.1
OPENSEARCH_CLUSTER_NAME=vaultize-production-cluster
OPENSEARCH_JAVA_OPTS=-Xms4g -Xmx4g  # Adjust based on server RAM

# Connection Settings
# IMPORTANT: Replace with your production OpenSearch hostname/IP
OPENSEARCH_HOST=opensearch.prod.internal
OPENSEARCH_PORT=9200
OPENSEARCH_SCHEME=https  # MUST use HTTPS in production

# Security (MANDATORY IN PRODUCTION)
OPENSEARCH_SECURITY_ENABLED=true
OPENSEARCH_ADMIN_USERNAME=admin
OPENSEARCH_ADMIN_PASSWORD=${VAULT_OPENSEARCH_ADMIN_PASSWORD}  # Use secrets manager
OPENSEARCH_VERIFY_CERTS=true  # MUST verify certificates

# ============================================================================
# OpenSearch Dashboards Configuration
# ============================================================================

OPENSEARCH_DASHBOARDS_VERSION=2.11.1
OPENSEARCH_DASHBOARDS_PORT=5601

# Public URL - Replace with your production domain
OPENSEARCH_DASHBOARDS_PUBLIC_URL=https://logs.example.com
OPENSEARCH_DASHBOARDS_BASE_PATH=  # e.g., /dashboards if behind reverse proxy

# ============================================================================
# Fluent Bit Configuration
# ============================================================================

FLUENT_BIT_VERSION=2.2.0
FLUENT_BIT_HTTP_PORT=2020
FLUENT_BIT_FORWARD_PORT=24224

# OpenSearch output configuration
FLUENT_BIT_OPENSEARCH_HOST=opensearch.prod.internal
FLUENT_BIT_OPENSEARCH_PORT=9200
FLUENT_BIT_OPENSEARCH_SCHEME=https
FLUENT_BIT_OPENSEARCH_USER=fluent_bit_writer
FLUENT_BIT_OPENSEARCH_PASSWORD=${VAULT_FLUENTBIT_PASSWORD}
FLUENT_BIT_OPENSEARCH_VERIFY_CERTS=true

# ============================================================================
# Prometheus Configuration (Optional)
# ============================================================================

PROMETHEUS_VERSION=v2.48.1
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION=90d  # 90 days for production

# Public URL
PROMETHEUS_URL=https://prometheus.example.com

# ============================================================================
# Grafana Configuration (Optional)
# ============================================================================

GRAFANA_VERSION=10.2.3
GRAFANA_PORT=3000

# Credentials - MUST use strong passwords
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=${VAULT_GRAFANA_ADMIN_PASSWORD}

# Public URLs
GRAFANA_URL=https://grafana.example.com
GRAFANA_ROOT_URL=https://grafana.example.com

# SSO/OAuth (Recommended for production)
GRAFANA_AUTH_GOOGLE_ENABLED=false
GRAFANA_AUTH_GOOGLE_CLIENT_ID=${GOOGLE_OAUTH_CLIENT_ID}
GRAFANA_AUTH_GOOGLE_CLIENT_SECRET=${GOOGLE_OAUTH_CLIENT_SECRET}

# ============================================================================
# Analytics API Configuration
# ============================================================================

API_HOST=0.0.0.0
API_PORT=8000
API_LOG_LEVEL=WARNING  # Reduce log verbosity in production
API_WORKERS=8  # Adjust based on CPU cores
API_RELOAD=false

# Public URL
API_BASE_URL=https://api.example.com
API_ROOT_PATH=/api/v1

# CORS Configuration - STRICT in production
API_CORS_ORIGINS=https://example.com,https://app.example.com

# API Security
API_SECRET_KEY=${VAULT_API_SECRET_KEY}
API_ACCESS_TOKEN_EXPIRE_MINUTES=30
API_REFRESH_TOKEN_EXPIRE_DAYS=7

# ============================================================================
# Alerting Service Configuration
# ============================================================================

ALERTING_LOG_LEVEL=WARNING
ALERTING_CHECK_INTERVAL=300  # 5 minutes in production
ALERTING_WEBHOOK_TIMEOUT=30  # seconds

# ============================================================================
# Network Configuration
# ============================================================================

NETWORK_SUBNET=172.25.0.0/16

# ============================================================================
# Storage Configuration
# ============================================================================

# Data retention policies (Compliance-driven)
LOG_RETENTION_DAYS=90  # Adjust based on compliance requirements
METRICS_RETENTION_DAYS=90

# ============================================================================
# Resource Limits (Production - High Performance)
# ============================================================================

OPENSEARCH_MEM_LIMIT=8g  # Adjust based on server capacity
FLUENT_BIT_MEM_LIMIT=1g
PROMETHEUS_MEM_LIMIT=4g
GRAFANA_MEM_LIMIT=1g

# ============================================================================
# External Integrations
# ============================================================================

# Webhook for alerts - Production Slack/PagerDuty
ALERT_WEBHOOK_URL=${VAULT_PROD_ALERT_WEBHOOK_URL}
ALERT_PAGERDUTY_KEY=${VAULT_PAGERDUTY_INTEGRATION_KEY}

# Email settings (Production SMTP)
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=${VAULT_SENDGRID_API_KEY}
SMTP_FROM=alerts@example.com
SMTP_USE_TLS=true

# ============================================================================
# TLS/SSL Configuration (MANDATORY IN PRODUCTION)
# ============================================================================

# Certificate paths
TLS_CERT_PATH=/etc/ssl/certs/production.crt
TLS_KEY_PATH=/etc/ssl/private/production.key
TLS_CA_PATH=/etc/ssl/certs/ca-production.crt

# Certificate verification
TLS_VERIFY_CLIENT=true
TLS_MIN_VERSION=1.2  # TLS 1.2 minimum

# ============================================================================
# Backup Configuration (CRITICAL)
# ============================================================================

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 1 * * *  # Daily at 1 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=vaultize-production-backups
BACKUP_S3_REGION=us-east-1
BACKUP_S3_ACCESS_KEY=${VAULT_S3_ACCESS_KEY}
BACKUP_S3_SECRET_KEY=${VAULT_S3_SECRET_KEY}
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY=${VAULT_BACKUP_ENCRYPTION_KEY}

# ============================================================================
# Monitoring & Observability (MANDATORY)
# ============================================================================

# Send metrics to monitoring system
METRICS_EXPORT_ENABLED=true
METRICS_EXPORT_ENDPOINT=https://monitoring.example.com/metrics

# Distributed tracing (APM)
TRACING_ENABLED=true
TRACING_SAMPLE_RATE=0.01  # 1% sampling to reduce overhead
TRACING_ENDPOINT=https://apm.example.com

# Health check endpoint
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ============================================================================
# High Availability Configuration
# ============================================================================

# Load balancer health checks
LB_HEALTH_CHECK_INTERVAL=10  # seconds
LB_HEALTH_CHECK_TIMEOUT=5    # seconds
LB_UNHEALTHY_THRESHOLD=3
LB_HEALTHY_THRESHOLD=2

# Session affinity (if needed)
SESSION_STICKY_ENABLED=false

# ============================================================================
# Feature Flags
# ============================================================================

# Production features (stable only)
FEATURE_VECTOR_SEARCH=false  # Enable only after thorough testing
FEATURE_ML_ANOMALY_DETECTION=false
FEATURE_ADVANCED_ALERTING=true

# ============================================================================
# Rate Limiting (Protection against abuse)
# ============================================================================

API_RATE_LIMIT_ENABLED=true
API_RATE_LIMIT_PER_MINUTE=10000  # Adjust based on expected traffic
API_RATE_LIMIT_BURST=1000

# ============================================================================
# Compliance & Audit
# ============================================================================

AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_PATH=/var/log/vaultize/audit.log
AUDIT_LOG_RETENTION_DAYS=365  # 1 year for compliance

# GDPR Compliance
GDPR_MODE_ENABLED=false
DATA_ANONYMIZATION_ENABLED=false

# ============================================================================
# Disaster Recovery
# ============================================================================

DR_ENABLED=true
DR_SNAPSHOT_INTERVAL=6h  # Snapshot every 6 hours
DR_REPLICATION_ENABLED=false  # Enable for multi-region DR
DR_REPLICATION_REGION=us-west-2

# ============================================================================
# Performance Tuning
# ============================================================================

# OpenSearch performance
OPENSEARCH_THREAD_POOL_SEARCH_SIZE=30
OPENSEARCH_THREAD_POOL_WRITE_SIZE=30
OPENSEARCH_INDICES_MEMORY_INDEX_BUFFER_SIZE=512mb

# API performance
API_CONNECTION_POOL_SIZE=100
API_MAX_OVERFLOW=50
API_POOL_TIMEOUT=30

# ============================================================================
# Secrets Management
# ============================================================================
#
# CRITICAL: Do NOT store secrets directly in this file in production
#
# Use a secrets manager instead:
# - HashiCorp Vault: ${vault:secret/path#key}
# - AWS Secrets Manager: ${aws:secretsmanager:secret-name}
# - Azure Key Vault: ${azure:keyvault:vault-name/secret-name}
# - Google Secret Manager: ${gcp:secretmanager:secret-name}
#
# Example with Vault:
# OPENSEARCH_ADMIN_PASSWORD=${vault:secret/opensearch#admin_password}
#
# ============================================================================

# ============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ============================================================================
#
# Security:
# [ ] All default passwords changed to strong passwords
# [ ] TLS/SSL enabled for all external endpoints
# [ ] Certificate verification enabled
# [ ] Authentication enabled for all services
# [ ] CORS restricted to actual domains (no wildcards)
# [ ] Secrets stored in secrets manager (not in .env file)
# [ ] Firewall rules configured (restrict access)
# [ ] VPN or private network for internal communication
#
# Reliability:
# [ ] Multi-node OpenSearch cluster (3+ nodes)
# [ ] Backups configured and tested
# [ ] Disaster recovery plan documented
# [ ] Health checks configured
# [ ] Monitoring and alerting operational
# [ ] Log aggregation for platform logs
#
# Performance:
# [ ] Resource limits set appropriately
# [ ] Connection pooling configured
# [ ] Rate limiting enabled
# [ ] Caching strategies implemented
#
# Compliance:
# [ ] Audit logging enabled
# [ ] Data retention policies defined
# [ ] GDPR/compliance requirements met
# [ ] Security audit completed
#
# Operations:
# [ ] Runbooks documented
# [ ] On-call rotation established
# [ ] Escalation procedures defined
# [ ] Backup restoration tested
# [ ] Disaster recovery tested
# [ ] Capacity planning completed
#
