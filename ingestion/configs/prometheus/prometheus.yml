# Prometheus Configuration
#
# Metrics collection configuration for the Vaultize Analytics Platform
#
# Authors: Balaji Rajan and Claude (Anthropic)
# License: Apache 2.0

# ============================================================================
# Global Configuration
# ============================================================================

global:
  scrape_interval: 15s      # Default scrape interval
  evaluation_interval: 15s  # Evaluate rules every 15s

  # External labels (for federation or remote write)
  external_labels:
    cluster: 'vaultize-cluster'
    environment: 'development'

# ============================================================================
# Alertmanager Configuration (Optional)
# ============================================================================

# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# ============================================================================
# Rule Files (Optional)
# ============================================================================

# rule_files:
#   - "rules/*.yml"

# ============================================================================
# Scrape Configurations
# ============================================================================

scrape_configs:
  # --------------------------------------------------------------------------
  # Prometheus itself
  # --------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # --------------------------------------------------------------------------
  # OpenSearch Cluster
  # --------------------------------------------------------------------------
  - job_name: 'opensearch'
    static_configs:
      - targets:
          - 'opensearch-node-1:9200'
          - 'opensearch-node-2:9200'
          - 'opensearch-node-3:9200'
        labels:
          cluster: 'vaultize-cluster'
          service: 'opensearch'
    metrics_path: '/_prometheus/metrics'
    # Note: Requires Prometheus exporter plugin for OpenSearch

  # --------------------------------------------------------------------------
  # OpenSearch Dashboards
  # --------------------------------------------------------------------------
  - job_name: 'opensearch-dashboards'
    static_configs:
      - targets: ['opensearch-dashboards:5601']
        labels:
          service: 'opensearch-dashboards'
    metrics_path: '/api/stats'

  # --------------------------------------------------------------------------
  # Fluent Bit
  # --------------------------------------------------------------------------
  - job_name: 'fluent-bit'
    static_configs:
      - targets: ['fluent-bit:2020']
        labels:
          service: 'fluent-bit'
    metrics_path: '/api/v1/metrics/prometheus'

  # --------------------------------------------------------------------------
  # Analytics API
  # --------------------------------------------------------------------------
  - job_name: 'analytics-api'
    static_configs:
      - targets: ['analytics-api:8000']
        labels:
          service: 'analytics-api'
    metrics_path: '/metrics'

  # --------------------------------------------------------------------------
  # Alerting Service
  # --------------------------------------------------------------------------
  - job_name: 'alerting-service'
    static_configs:
      - targets: ['alerting-service:8001']
        labels:
          service: 'alerting-service'
    metrics_path: '/metrics'

  # --------------------------------------------------------------------------
  # Node Exporter (if deployed for host metrics)
  # --------------------------------------------------------------------------
  # - job_name: 'node-exporter'
  #   static_configs:
  #     - targets: ['node-exporter:9100']
  #       labels:
  #         service: 'node-exporter'

  # --------------------------------------------------------------------------
  # Docker Daemon Metrics (if exposed)
  # --------------------------------------------------------------------------
  # - job_name: 'docker'
  #   static_configs:
  #     - targets: ['host.docker.internal:9323']
  #       labels:
  #         service: 'docker'

# ============================================================================
# Remote Write (Optional - for long-term storage)
# ============================================================================

# remote_write:
#   - url: "http://long-term-storage:9009/api/v1/push"
#     queue_config:
#       capacity: 10000
#       max_shards: 10
#       min_shards: 1
#       max_samples_per_send: 5000

# ============================================================================
# Remote Read (Optional)
# ============================================================================

# remote_read:
#   - url: "http://long-term-storage:9009/api/v1/read"
